import{__toESM as e,common$1 as t,getConfig as n,getStylesFromArray as r,interpolateToCurve as i,linear_default as a,log$1 as o,require_dayjs_min as s,require_dist as c,select_default as l,setupGraphViewbox$1 as u,utils as d}from"./mermaid-b5860b54.CzyV0eq4.js";import"./preload-helper.C0X9M0sG.js";import"./path.CnsJDNhh.js";import"./array.DpZ2OJ07.js";import"./line.DTlckFuN.js";import{Graph as f}from"./graphlib.B9UfIqo0.js";import"./clone.A1bABoxq.js";import"./createText-2e5e7dd3.DgWvnF3i.js";import"./edges-e0da2a9e.DFFloXIu.js";import"./dagre.v2GxACLv.js";import{db as p,parser$1 as m,styles as h}from"./styles-9a916d00.CJkIdIKB.js";import{render as g}from"./index-3862675e.Dv-q5Ebf.js";var _=e(s()),v=e(c());const y=e=>t.sanitizeText(e,n());let b={dividerMargin:10,padding:5,textHeight:10,curve:void 0};const x=function(e,t,r,i){let a=Object.keys(e);o.info(`keys:`,a),o.info(e),a.forEach(function(a){var s,c;let l=e[a],u=`rect`,d={shape:u,id:l.id,domId:l.domId,labelText:y(l.id),labelStyle:``,style:`fill: none; stroke: black`,padding:(s=n().flowchart)?.padding??(c=n().class)?.padding};t.setNode(l.id,d),S(l.classes,t,r,i,l.id),o.info(`setNode`,d)})},S=function(e,t,i,a,s){let c=Object.keys(e);o.info(`keys:`,c),o.info(e),c.filter(t=>e[t].parent==s).forEach(function(i){var c,l;let u=e[i],d=u.cssClasses.join(` `),f=r(u.styles),p=u.label??u.id,m=0,h=`class_box`,g={labelStyle:f.labelStyle,shape:h,labelText:y(p),classData:u,rx:m,ry:m,class:d,style:f.style,id:u.id,domId:u.domId,tooltip:a.db.getTooltip(u.id,s)||``,haveCallback:u.haveCallback,link:u.link,width:u.type===`group`?500:void 0,type:u.type,padding:(c=n().flowchart)?.padding??(l=n().class)?.padding};t.setNode(u.id,g),s&&t.setParent(u.id,s),o.info(`setNode`,g)})},C=function(e,t,r,s){o.info(e),e.forEach(function(e,c){var l,u;let d=e,f=``,p={labelStyle:``,style:``},m=d.text,h=0,g=`note`,_={labelStyle:p.labelStyle,shape:g,labelText:y(m),noteData:d,rx:h,ry:h,class:f,style:p.style,id:d.id,domId:d.id,tooltip:``,type:`note`,padding:(l=n().flowchart)?.padding??(u=n().class)?.padding};if(t.setNode(d.id,_),o.info(`setNode`,_),!d.class||!(d.class in s))return;let v=r+c,x={id:`edgeNote${v}`,classes:`relation`,pattern:`dotted`,arrowhead:`none`,startLabelRight:``,endLabelLeft:``,arrowTypeStart:`none`,arrowTypeEnd:`none`,style:`fill:none`,labelStyle:``,curve:i(b.curve,a)};t.setEdge(d.id,d.class,x,v)})},w=function(e,s){let c=n().flowchart,l=0;e.forEach(function(e){var u;l++;let d={classes:`relation`,pattern:e.relation.lineType==1?`dashed`:`solid`,id:`id_${e.id1}_${e.id2}_${l}`,arrowhead:e.type===`arrow_open`?`none`:`normal`,startLabelRight:e.relationTitle1===`none`?``:e.relationTitle1,endLabelLeft:e.relationTitle2===`none`?``:e.relationTitle2,arrowTypeStart:D(e.relation.type1),arrowTypeEnd:D(e.relation.type2),style:`fill:none`,labelStyle:``,curve:i(c?.curve,a)};if(o.info(d,e),e.style!==void 0){let t=r(e.style);d.style=t.style,d.labelStyle=t.labelStyle}e.text=e.title,e.text===void 0?e.style!==void 0&&(d.arrowheadStyle=`fill: #333`):(d.arrowheadStyle=`fill: #333`,d.labelpos=`c`,(u=n().flowchart)?.htmlLabels??n().htmlLabels?(d.labelType=`html`,d.label=`<span class="edgeLabel">`+e.text+`</span>`):(d.labelType=`text`,d.label=e.text.replace(t.lineBreakRegex,`
`),e.style===void 0&&(d.style=d.style||`stroke: #333; stroke-width: 1.5px;fill:none`),d.labelStyle=d.labelStyle.replace(`color:`,`fill:`))),s.setEdge(e.id1,e.id2,d,l)})},T=function(e){b={...b,...e}},E=async function(e,t,r,i){o.info(`Drawing class - `,t);let a=n().flowchart??n().class,s=n().securityLevel;o.info(`config:`,a);let c=a?.nodeSpacing??50,p=a?.rankSpacing??50,m=new f({multigraph:!0,compound:!0}).setGraph({rankdir:i.db.getDirection(),nodesep:c,ranksep:p,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}}),h=i.db.getNamespaces(),_=i.db.getClasses(),v=i.db.getRelations(),y=i.db.getNotes();o.info(v),x(h,m,t,i),S(_,m,t,i),w(v,m),C(y,m,v.length+1,_);let b;s===`sandbox`&&(b=l(`#i`+t));let T=l(s===`sandbox`?b.nodes()[0].contentDocument.body:`body`),E=T.select(`[id="${t}"]`),D=T.select(`#`+t+` g`);if(await g(D,m,[`aggregation`,`extension`,`composition`,`dependency`,`lollipop`],`classDiagram`,t),d.insertTitle(E,`classTitleText`,a?.titleTopMargin??5,i.db.getDiagramTitle()),u(m,E,a?.diagramPadding,a?.useMaxWidth),!a?.htmlLabels){let e=s===`sandbox`?b.nodes()[0].contentDocument:document,n=e.querySelectorAll(`[id="`+t+`"] .edgeLabel .label`);for(let t of n){let n=t.getBBox(),r=e.createElementNS(`http://www.w3.org/2000/svg`,`rect`);r.setAttribute(`rx`,0),r.setAttribute(`ry`,0),r.setAttribute(`width`,n.width),r.setAttribute(`height`,n.height),t.insertBefore(r,t.firstChild)}}};function D(e){let t;switch(e){case 0:t=`aggregation`;break;case 1:t=`extension`;break;case 2:t=`composition`;break;case 3:t=`dependency`;break;case 4:t=`lollipop`;break;default:t=`none`}return t}const O={setConf:T,draw:E},k={parser:m,db:p,renderer:O,styles:h,init:e=>{e.class||={},e.class.arrowMarkerAbsolute=e.arrowMarkerAbsolute,p.clear()}};export{k as diagram};