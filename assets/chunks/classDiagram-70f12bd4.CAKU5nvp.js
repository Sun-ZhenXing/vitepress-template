import{__toESM as e,basis_default as t,configureSvgSize as n,getConfig as r,log$1 as i,parseGenericTypes as a,require_dayjs_min as o,require_dist as s,select_default as c,utils as l}from"./mermaid-b5860b54.CzyV0eq4.js";import"./preload-helper.C0X9M0sG.js";import"./path.CnsJDNhh.js";import"./array.DpZ2OJ07.js";import{line_default as u}from"./line.DTlckFuN.js";import{Graph as d}from"./graphlib.B9UfIqo0.js";import{layout as f}from"./dagre.v2GxACLv.js";import{db as p,parser$1 as m,styles as h}from"./styles-9a916d00.CJkIdIKB.js";var g=e(o()),_=e(s());let v=0;const y=function(e,n,r,a,o){let s=function(e){switch(e){case o.db.relationType.AGGREGATION:return`aggregation`;case o.db.relationType.EXTENSION:return`extension`;case o.db.relationType.COMPOSITION:return`composition`;case o.db.relationType.DEPENDENCY:return`dependency`;case o.db.relationType.LOLLIPOP:return`lollipop`}};n.points=n.points.filter(e=>!Number.isNaN(e.y));let c=n.points,d=u().x(function(e){return e.x}).y(function(e){return e.y}).curve(t),f=e.append(`path`).attr(`d`,d(c)).attr(`id`,`edge`+v).attr(`class`,`relation`),p=``;a.arrowMarkerAbsolute&&(p=window.location.protocol+`//`+window.location.host+window.location.pathname+window.location.search,p=p.replace(/\(/g,`\\(`),p=p.replace(/\)/g,`\\)`)),r.relation.lineType==1&&f.attr(`class`,`relation dashed-line`),r.relation.lineType==10&&f.attr(`class`,`relation dotted-line`),r.relation.type1!==`none`&&f.attr(`marker-start`,`url(`+p+`#`+s(r.relation.type1)+`Start)`),r.relation.type2!==`none`&&f.attr(`marker-end`,`url(`+p+`#`+s(r.relation.type2)+`End)`);let m,h,g=n.points.length,_=l.calcLabelPosition(n.points);m=_.x,h=_.y;let y,b,x,S;if(g%2!=0&&g>1){let e=l.calcCardinalityPosition(r.relation.type1!==`none`,n.points,n.points[0]),t=l.calcCardinalityPosition(r.relation.type2!==`none`,n.points,n.points[g-1]);i.debug(`cardinality_1_point `+JSON.stringify(e)),i.debug(`cardinality_2_point `+JSON.stringify(t)),y=e.x,b=e.y,x=t.x,S=t.y}if(r.title!==void 0){let t=e.append(`g`).attr(`class`,`classLabel`),n=t.append(`text`).attr(`class`,`label`).attr(`x`,m).attr(`y`,h).attr(`fill`,`red`).attr(`text-anchor`,`middle`).text(r.title);window.label=n;let i=n.node().getBBox();t.insert(`rect`,`:first-child`).attr(`class`,`box`).attr(`x`,i.x-a.padding/2).attr(`y`,i.y-a.padding/2).attr(`width`,i.width+a.padding).attr(`height`,i.height+a.padding)}if(i.info(`Rendering relation `+JSON.stringify(r)),r.relationTitle1!==void 0&&r.relationTitle1!==`none`){let t=e.append(`g`).attr(`class`,`cardinality`);t.append(`text`).attr(`class`,`type1`).attr(`x`,y).attr(`y`,b).attr(`fill`,`black`).attr(`font-size`,`6`).text(r.relationTitle1)}if(r.relationTitle2!==void 0&&r.relationTitle2!==`none`){let t=e.append(`g`).attr(`class`,`cardinality`);t.append(`text`).attr(`class`,`type2`).attr(`x`,x).attr(`y`,S).attr(`fill`,`black`).attr(`font-size`,`6`).text(r.relationTitle2)}v++},b=function(e,t,n,r){i.debug(`Rendering class `,t,n);let a=t.id,o={id:a,label:t.id,width:0,height:0},s=e.append(`g`).attr(`id`,r.db.lookUpDomId(a)).attr(`class`,`classGroup`),c;c=t.link?s.append(`svg:a`).attr(`xlink:href`,t.link).attr(`target`,t.linkTarget).append(`text`).attr(`y`,n.textHeight+n.padding).attr(`x`,0):s.append(`text`).attr(`y`,n.textHeight+n.padding).attr(`x`,0);let l=!0;t.annotations.forEach(function(e){let t=c.append(`tspan`).text(`«`+e+`»`);l||t.attr(`dy`,n.textHeight),l=!1});let u=x(t),d=c.append(`tspan`).text(u).attr(`class`,`title`);l||d.attr(`dy`,n.textHeight);let f=c.node().getBBox().height,p,m,h;if(t.members.length>0){p=s.append(`line`).attr(`x1`,0).attr(`y1`,n.padding+f+n.dividerMargin/2).attr(`y2`,n.padding+f+n.dividerMargin/2);let e=s.append(`text`).attr(`x`,n.padding).attr(`y`,f+n.dividerMargin+n.textHeight).attr(`fill`,`white`).attr(`class`,`classText`);l=!0,t.members.forEach(function(t){C(e,t,l,n),l=!1}),m=e.node().getBBox()}if(t.methods.length>0){h=s.append(`line`).attr(`x1`,0).attr(`y1`,n.padding+f+n.dividerMargin+m.height).attr(`y2`,n.padding+f+n.dividerMargin+m.height);let e=s.append(`text`).attr(`x`,n.padding).attr(`y`,f+2*n.dividerMargin+m.height+n.textHeight).attr(`fill`,`white`).attr(`class`,`classText`);l=!0,t.methods.forEach(function(t){C(e,t,l,n),l=!1})}let g=s.node().getBBox();var _=` `;t.cssClasses.length>0&&(_+=t.cssClasses.join(` `));let v=s.insert(`rect`,`:first-child`).attr(`x`,0).attr(`y`,0).attr(`width`,g.width+2*n.padding).attr(`height`,g.height+n.padding+.5*n.dividerMargin).attr(`class`,_),y=v.node().getBBox().width;return c.node().childNodes.forEach(function(e){e.setAttribute(`x`,(y-e.getBBox().width)/2)}),t.tooltip&&c.insert(`title`).text(t.tooltip),p&&p.attr(`x2`,y),h&&h.attr(`x2`,y),o.width=y,o.height=g.height+n.padding+.5*n.dividerMargin,o},x=function(e){let t=e.id;return e.type&&(t+=`<`+a(e.type)+`>`),t},S=function(e,t,n,r){i.debug(`Rendering note `,t,n);let a=t.id,o={id:a,text:t.text,width:0,height:0},s=e.append(`g`).attr(`id`,a).attr(`class`,`classGroup`),c=s.append(`text`).attr(`y`,n.textHeight+n.padding).attr(`x`,0),l=JSON.parse(`"${t.text}"`).split(`
`);l.forEach(function(e){i.debug(`Adding line: ${e}`),c.append(`tspan`).text(e).attr(`class`,`title`).attr(`dy`,n.textHeight)});let u=s.node().getBBox(),d=s.insert(`rect`,`:first-child`).attr(`x`,0).attr(`y`,0).attr(`width`,u.width+2*n.padding).attr(`height`,u.height+l.length*n.textHeight+n.padding+.5*n.dividerMargin),f=d.node().getBBox().width;return c.node().childNodes.forEach(function(e){e.setAttribute(`x`,(f-e.getBBox().width)/2)}),o.width=f,o.height=u.height+l.length*n.textHeight+n.padding+.5*n.dividerMargin,o},C=function(e,t,n,r){let{displayText:i,cssStyle:a}=t.getDisplayDetails(),o=e.append(`tspan`).attr(`x`,r.padding).text(i);a!==``&&o.attr(`style`,t.cssStyle),n||o.attr(`dy`,r.textHeight)},w={getClassTitleString:x,drawClass:b,drawEdge:y,drawNote:S};let T={};const E=20,D=function(e){let t=Object.entries(T).find(t=>t[1].label===e);if(t)return t[0]},O=function(e){e.append(`defs`).append(`marker`).attr(`id`,`extensionStart`).attr(`class`,`extension`).attr(`refX`,0).attr(`refY`,7).attr(`markerWidth`,190).attr(`markerHeight`,240).attr(`orient`,`auto`).append(`path`).attr(`d`,`M 1,7 L18,13 V 1 Z`),e.append(`defs`).append(`marker`).attr(`id`,`extensionEnd`).attr(`refX`,19).attr(`refY`,7).attr(`markerWidth`,20).attr(`markerHeight`,28).attr(`orient`,`auto`).append(`path`).attr(`d`,`M 1,1 V 13 L18,7 Z`),e.append(`defs`).append(`marker`).attr(`id`,`compositionStart`).attr(`class`,`extension`).attr(`refX`,0).attr(`refY`,7).attr(`markerWidth`,190).attr(`markerHeight`,240).attr(`orient`,`auto`).append(`path`).attr(`d`,`M 18,7 L9,13 L1,7 L9,1 Z`),e.append(`defs`).append(`marker`).attr(`id`,`compositionEnd`).attr(`refX`,19).attr(`refY`,7).attr(`markerWidth`,20).attr(`markerHeight`,28).attr(`orient`,`auto`).append(`path`).attr(`d`,`M 18,7 L9,13 L1,7 L9,1 Z`),e.append(`defs`).append(`marker`).attr(`id`,`aggregationStart`).attr(`class`,`extension`).attr(`refX`,0).attr(`refY`,7).attr(`markerWidth`,190).attr(`markerHeight`,240).attr(`orient`,`auto`).append(`path`).attr(`d`,`M 18,7 L9,13 L1,7 L9,1 Z`),e.append(`defs`).append(`marker`).attr(`id`,`aggregationEnd`).attr(`refX`,19).attr(`refY`,7).attr(`markerWidth`,20).attr(`markerHeight`,28).attr(`orient`,`auto`).append(`path`).attr(`d`,`M 18,7 L9,13 L1,7 L9,1 Z`),e.append(`defs`).append(`marker`).attr(`id`,`dependencyStart`).attr(`class`,`extension`).attr(`refX`,0).attr(`refY`,7).attr(`markerWidth`,190).attr(`markerHeight`,240).attr(`orient`,`auto`).append(`path`).attr(`d`,`M 5,7 L9,13 L1,7 L9,1 Z`),e.append(`defs`).append(`marker`).attr(`id`,`dependencyEnd`).attr(`refX`,19).attr(`refY`,7).attr(`markerWidth`,20).attr(`markerHeight`,28).attr(`orient`,`auto`).append(`path`).attr(`d`,`M 18,7 L9,13 L14,7 L9,1 Z`)},k=function(e,t,a,o){let s=r().class;T={},i.info(`Rendering diagram `+e);let l=r().securityLevel,u;l===`sandbox`&&(u=c(`#i`+t));let p=c(l===`sandbox`?u.nodes()[0].contentDocument.body:`body`),m=p.select(`[id='${t}']`);O(m);let h=new d({multigraph:!0});h.setGraph({isMultiGraph:!0}),h.setDefaultEdgeLabel(function(){return{}});let g=o.db.getClasses(),_=Object.keys(g);for(let e of _){let t=g[e],n=w.drawClass(m,t,s,o);T[n.id]=n,h.setNode(n.id,n),i.info(`Org height: `+n.height)}let v=o.db.getRelations();v.forEach(function(e){i.info(`tjoho`+D(e.id1)+D(e.id2)+JSON.stringify(e)),h.setEdge(D(e.id1),D(e.id2),{relation:e},e.title||`DEFAULT`)});let y=o.db.getNotes();y.forEach(function(e){i.debug(`Adding note: ${JSON.stringify(e)}`);let t=w.drawNote(m,e,s,o);T[t.id]=t,h.setNode(t.id,t),e.class&&e.class in g&&h.setEdge(e.id,D(e.class),{relation:{id1:e.id,id2:e.class,relation:{type1:`none`,type2:`none`,lineType:10}}},`DEFAULT`)}),f(h),h.nodes().forEach(function(e){e!==void 0&&h.node(e)!==void 0&&(i.debug(`Node `+e+`: `+JSON.stringify(h.node(e))),p.select(`#`+(o.db.lookUpDomId(e)||e)).attr(`transform`,`translate(`+(h.node(e).x-h.node(e).width/2)+`,`+(h.node(e).y-h.node(e).height/2)+` )`))}),h.edges().forEach(function(e){e!==void 0&&h.edge(e)!==void 0&&(i.debug(`Edge `+e.v+` -> `+e.w+`: `+JSON.stringify(h.edge(e))),w.drawEdge(m,h.edge(e),h.edge(e).relation,s,o))});let b=m.node().getBBox(),x=b.width+E*2,S=b.height+E*2;n(m,S,x,s.useMaxWidth);let C=`${b.x-E} ${b.y-E} ${x} ${S}`;i.debug(`viewBox ${C}`),m.attr(`viewBox`,C)},A={draw:k},j={parser:m,db:p,renderer:A,styles:h,init:e=>{e.class||={},e.class.arrowMarkerAbsolute=e.arrowMarkerAbsolute,p.clear()}};export{j as diagram};