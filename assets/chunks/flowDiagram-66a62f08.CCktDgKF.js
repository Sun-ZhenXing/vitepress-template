import{__toESM as e,common$1 as t,evaluate as n,getConfig as r,getStylesFromArray as i,interpolateToCurve as a,linear_default as o,log$1 as s,renderKatex as c,require_dayjs_min as l,require_dist as u,select_default as d,setupGraphViewbox$1 as f}from"./mermaid-b5860b54.CzyV0eq4.js";import"./preload-helper.C0X9M0sG.js";import{addHtmlLabel as p,applyClass as m,applyStyle as h,applyTransition as g,edgeToId as _,flowRendererV2 as v,flowStyles as y,isSubgraph as b,selectAll_default as ee}from"./styles-c10674c1.BVn17SaA.js";import"./path.CnsJDNhh.js";import"./array.DpZ2OJ07.js";import{line_default as x}from"./line.DTlckFuN.js";import"./channel.BIT4_Eyc.js";import{Graph as te,forEach_default as S,has_default as C}from"./graphlib.B9UfIqo0.js";import"./clone.A1bABoxq.js";import"./createText-2e5e7dd3.DgWvnF3i.js";import"./edges-e0da2a9e.DFFloXIu.js";import{defaults_default as w,layout as T,pick_default as E,range_default as ne,uniqueId_default as re}from"./dagre.v2GxACLv.js";import"./index-3862675e.Dv-q5Ebf.js";import{flowDb as D,parser$1 as ie}from"./flowDb-956e92f1.C5ItpKAY.js";function ae(e){if(!e.ok)throw Error(e.status+` `+e.statusText);return e.text()}function oe(e,t){return fetch(e,t).then(ae)}function O(e){return(t,n)=>oe(t,n).then(t=>new DOMParser().parseFromString(t,e))}var se=O(`application/xml`),ce=O(`text/html`),le=O(`image/svg+xml`),k={normal:de,vee:fe,undirected:pe};function ue(e){k=e}function de(e,t,n,r){var i=e.append(`marker`).attr(`id`,t).attr(`viewBox`,`0 0 10 10`).attr(`refX`,9).attr(`refY`,5).attr(`markerUnits`,`strokeWidth`).attr(`markerWidth`,8).attr(`markerHeight`,6).attr(`orient`,`auto`),a=i.append(`path`).attr(`d`,`M 0 0 L 10 5 L 0 10 z`).style(`stroke-width`,1).style(`stroke-dasharray`,`1,0`);h(a,n[r+`Style`]),n[r+`Class`]&&a.attr(`class`,n[r+`Class`])}function fe(e,t,n,r){var i=e.append(`marker`).attr(`id`,t).attr(`viewBox`,`0 0 10 10`).attr(`refX`,9).attr(`refY`,5).attr(`markerUnits`,`strokeWidth`).attr(`markerWidth`,8).attr(`markerHeight`,6).attr(`orient`,`auto`),a=i.append(`path`).attr(`d`,`M 0 0 L 10 5 L 0 10 L 4 5 z`).style(`stroke-width`,1).style(`stroke-dasharray`,`1,0`);h(a,n[r+`Style`]),n[r+`Class`]&&a.attr(`class`,n[r+`Class`])}function pe(e,t,n,r){var i=e.append(`marker`).attr(`id`,t).attr(`viewBox`,`0 0 10 10`).attr(`refX`,9).attr(`refY`,5).attr(`markerUnits`,`strokeWidth`).attr(`markerWidth`,8).attr(`markerHeight`,6).attr(`orient`,`auto`),a=i.append(`path`).attr(`d`,`M 0 5 L 10 5`).style(`stroke-width`,1).style(`stroke-dasharray`,`1,0`);h(a,n[r+`Style`]),n[r+`Class`]&&a.attr(`class`,n[r+`Class`])}function me(e,t){var n=e;return n.node().appendChild(t.label),h(n,t.labelStyle),n}function he(e,t){for(var n=e.append(`text`),r=ge(t.label).split(`
`),i=0;i<r.length;i++)n.append(`tspan`).attr(`xml:space`,`preserve`).attr(`dy`,`1em`).attr(`x`,`1`).text(r[i]);return h(n,t.labelStyle),n}function ge(e){for(var t=``,n=!1,r,i=0;i<e.length;++i)if(r=e[i],n){switch(r){case`n`:t+=`
`;break;default:t+=r}n=!1}else r===`\\`?n=!0:t+=r;return t}function A(e,t,n){var r=t.label,i=e.append(`g`);t.labelType===`svg`?me(i,t):typeof r!=`string`||t.labelType===`html`?p(i,t):he(i,t);var a=i.node().getBBox(),o;switch(n){case`top`:o=-t.height/2;break;case`bottom`:o=t.height/2-a.height;break;default:o=-a.height/2}return i.attr(`transform`,`translate(`+-a.width/2+`,`+o+`)`),i}var j=function(e,t){var n=t.nodes().filter(function(e){return b(t,e)}),r=e.selectAll(`g.cluster`).data(n,function(e){return e});g(r.exit(),t).style(`opacity`,0).remove();var i=r.enter().append(`g`).attr(`class`,`cluster`).attr(`id`,function(e){var n=t.node(e);return n.id}).style(`opacity`,0).each(function(e){var n=t.node(e),r=d(this);d(this).append(`rect`);var i=r.append(`g`).attr(`class`,`label`);A(i,n,n.clusterLabelPos)});return r=r.merge(i),r=g(r,t).style(`opacity`,1),r.selectAll(`rect`).each(function(e){var n=t.node(e),r=d(this);h(r,n.style)}),r};function _e(e){j=e}let M=function(e,t){var n=e.selectAll(`g.edgeLabel`).data(t.edges(),function(e){return _(e)}).classed(`update`,!0);n.exit().remove(),n.enter().append(`g`).classed(`edgeLabel`,!0).style(`opacity`,0),n=e.selectAll(`g.edgeLabel`),n.each(function(e){var n=d(this);n.select(`.label`).remove();var r=t.edge(e),i=A(n,t.edge(e),0).classed(`label`,!0),a=i.node().getBBox();r.labelId&&i.attr(`id`,r.labelId),C(r,`width`)||(r.width=a.width),C(r,`height`)||(r.height=a.height)});var r;return r=n.exit?n.exit():n.selectAll(null),g(r,t).style(`opacity`,0).remove(),n};function ve(e){M=e}function N(e,t){return e.intersect(t)}var P=function(e,t,n){var r=e.selectAll(`g.edgePath`).data(t.edges(),function(e){return _(e)}).classed(`update`,!0),i=Ce(r,t);we(r,t);var a=r.merge===void 0?r:r.merge(i);return g(a,t).style(`opacity`,1),a.each(function(e){var n=d(this),r=t.edge(e);r.elem=this,r.id&&n.attr(`id`,r.id),m(n,r.class,(n.classed(`update`)?`update `:``)+`edgePath`)}),a.selectAll(`path.path`).each(function(e){var n=t.edge(e);n.arrowheadId=re(`arrowhead`);var r=d(this).attr(`marker-end`,function(){return`url(`+be(location.href,n.arrowheadId)+`)`}).style(`fill`,`none`);g(r,t).attr(`d`,function(e){return xe(t,e)}),h(r,n.style)}),a.selectAll(`defs *`).remove(),a.selectAll(`defs`).each(function(e){var r=t.edge(e),i=n[r.arrowhead];i(d(this),r.arrowheadId,r,`arrowhead`)}),a};function ye(e){P=e}function be(e,t){var n=e.split(`#`)[0];return n+`#`+t}function xe(e,t){var n=e.edge(t),r=e.node(t.v),i=e.node(t.w),a=n.points.slice(1,n.points.length-1);return a.unshift(N(r,a[0])),a.push(N(i,a[a.length-1])),F(n,a)}function F(e,t){var n=(x||le.line)().x(function(e){return e.x}).y(function(e){return e.y});return(n.curve||n.interpolate)(e.curve),n(t)}function Se(e){var t=e.getBBox(),n=e.ownerSVGElement.getScreenCTM().inverse().multiply(e.getScreenCTM()).translate(t.width/2,t.height/2);return{x:n.e,y:n.f}}function Ce(e,t){var n=e.enter().append(`g`).attr(`class`,`edgePath`).style(`opacity`,0);return n.append(`path`).attr(`class`,`path`).attr(`d`,function(e){var n=t.edge(e),r=t.node(e.v).elem,i=ne(n.points.length).map(function(){return Se(r)});return F(n,i)}),n.append(`defs`),n}function we(e,t){var n=e.exit();g(n,t).style(`opacity`,0).remove()}var I=function(e,t,n){var r=t.nodes().filter(function(e){return!b(t,e)}),i=e.selectAll(`g.node`).data(r,function(e){return e}).classed(`update`,!0);i.exit().remove(),i.enter().append(`g`).attr(`class`,`node`).style(`opacity`,0),i=e.selectAll(`g.node`),i.each(function(e){var r=t.node(e),i=d(this);m(i,r.class,(i.classed(`update`)?`update `:``)+`node`),i.select(`g.label`).remove();var a=i.append(`g`).attr(`class`,`label`),o=A(a,r),s=n[r.shape],c=E(o.node().getBBox(),`width`,`height`);r.elem=this,r.id&&i.attr(`id`,r.id),r.labelId&&a.attr(`id`,r.labelId),C(r,`width`)&&(c.width=r.width),C(r,`height`)&&(c.height=r.height),c.width+=r.paddingLeft+r.paddingRight,c.height+=r.paddingTop+r.paddingBottom,a.attr(`transform`,`translate(`+(r.paddingLeft-r.paddingRight)/2+`,`+(r.paddingTop-r.paddingBottom)/2+`)`);var l=d(this);l.select(`.label-container`).remove();var u=s(l,c,r).classed(`label-container`,!0);h(u,r.style);var f=u.node().getBBox();r.width=f.width,r.height=f.height});var a;return a=i.exit?i.exit():i.selectAll(null),g(a,t).style(`opacity`,0).remove(),i};function Te(e){I=e}function Ee(e,t){var n=e.filter(function(){return!d(this).classed(`update`)});function r(e){var n=t.node(e);return`translate(`+n.x+`,`+n.y+`)`}n.attr(`transform`,r),g(e,t).style(`opacity`,1).attr(`transform`,r),g(n.selectAll(`rect`),t).attr(`width`,function(e){return t.node(e).width}).attr(`height`,function(e){return t.node(e).height}).attr(`x`,function(e){var n=t.node(e);return-n.width/2}).attr(`y`,function(e){var n=t.node(e);return-n.height/2})}function De(e,t){var n=e.filter(function(){return!d(this).classed(`update`)});function r(e){var n=t.edge(e);return C(n,`x`)?`translate(`+n.x+`,`+n.y+`)`:``}n.attr(`transform`,r),g(e,t).style(`opacity`,1).attr(`transform`,r)}function Oe(e,t){var n=e.filter(function(){return!d(this).classed(`update`)});function r(e){var n=t.node(e);return`translate(`+n.x+`,`+n.y+`)`}n.attr(`transform`,r),g(e,t).style(`opacity`,1).attr(`transform`,r)}function L(e,t,n,r){var i=e.x,a=e.y,o=i-r.x,s=a-r.y,c=Math.sqrt(t*t*s*s+n*n*o*o),l=Math.abs(t*n*o/c);r.x<i&&(l=-l);var u=Math.abs(t*n*s/c);return r.y<a&&(u=-u),{x:i+l,y:a+u}}function ke(e,t,n){return L(e,t,t,n)}function Ae(e,t,n,r){var i,a,o,s,c,l,u,d,f,p,m,h,g,_,v;if(i=t.y-e.y,o=e.x-t.x,c=t.x*e.y-e.x*t.y,f=i*n.x+o*n.y+c,p=i*r.x+o*r.y+c,!(f!==0&&p!==0&&R(f,p))&&(a=r.y-n.y,s=n.x-r.x,l=r.x*n.y-n.x*r.y,u=a*e.x+s*e.y+l,d=a*t.x+s*t.y+l,!(u!==0&&d!==0&&R(u,d))&&(m=i*s-a*o,m!==0)))return h=Math.abs(m/2),g=o*l-s*c,_=g<0?(g-h)/m:(g+h)/m,g=a*c-i*l,v=g<0?(g-h)/m:(g+h)/m,{x:_,y:v}}function R(e,t){return e*t>0}function z(e,t,n){var r=e.x,i=e.y,a=[],o=1/0,s=1/0;t.forEach(function(e){o=Math.min(o,e.x),s=Math.min(s,e.y)});for(var c=r-e.width/2-o,l=i-e.height/2-s,u=0;u<t.length;u++){var d=t[u],f=t[u<t.length-1?u+1:0],p=Ae(e,n,{x:c+d.x,y:l+d.y},{x:c+f.x,y:l+f.y});p&&a.push(p)}return a.length?(a.length>1&&a.sort(function(e,t){var r=e.x-n.x,i=e.y-n.y,a=Math.sqrt(r*r+i*i),o=t.x-n.x,s=t.y-n.y,c=Math.sqrt(o*o+s*s);return a<c?-1:a===c?0:1}),a[0]):(console.log(`NO INTERSECTION FOUND, RETURN NODE CENTER`,e),e)}function B(e,t){var n=e.x,r=e.y,i=t.x-n,a=t.y-r,o=e.width/2,s=e.height/2,c,l;return Math.abs(a)*o>Math.abs(i)*s?(a<0&&(s=-s),c=a===0?0:s*i/a,l=s):(i<0&&(o=-o),c=o,l=i===0?0:o*a/i),{x:n+c,y:r+l}}var V={rect:Me,ellipse:Ne,circle:Pe,diamond:Fe};function je(e){V=e}function Me(e,t,n){var r=e.insert(`rect`,`:first-child`).attr(`rx`,n.rx).attr(`ry`,n.ry).attr(`x`,-t.width/2).attr(`y`,-t.height/2).attr(`width`,t.width).attr(`height`,t.height);return n.intersect=function(e){return B(n,e)},r}function Ne(e,t,n){var r=t.width/2,i=t.height/2,a=e.insert(`ellipse`,`:first-child`).attr(`x`,-t.width/2).attr(`y`,-t.height/2).attr(`rx`,r).attr(`ry`,i);return n.intersect=function(e){return L(n,r,i,e)},a}function Pe(e,t,n){var r=Math.max(t.width,t.height)/2,i=e.insert(`circle`,`:first-child`).attr(`x`,-t.width/2).attr(`y`,-t.height/2).attr(`r`,r);return n.intersect=function(e){return ke(n,r,e)},i}function Fe(e,t,n){var r=t.width*Math.SQRT2/2,i=t.height*Math.SQRT2/2,a=[{x:0,y:-i},{x:-r,y:0},{x:0,y:i},{x:r,y:0}],o=e.insert(`polygon`,`:first-child`).attr(`points`,a.map(function(e){return e.x+`,`+e.y}).join(` `));return n.intersect=function(e){return z(n,a,e)},o}function Ie(){var e=function(e,t){ze(t);var n=H(e,`output`),r=H(n,`clusters`),i=H(n,`edgePaths`),a=M(H(n,`edgeLabels`),t),o=I(H(n,`nodes`),t,V);T(t),Oe(o,t),De(a,t),P(i,t,k);var s=j(r,t);Ee(s,t),Be(t)};return e.createNodes=function(t){return arguments.length?(Te(t),e):I},e.createClusters=function(t){return arguments.length?(_e(t),e):j},e.createEdgeLabels=function(t){return arguments.length?(ve(t),e):M},e.createEdgePaths=function(t){return arguments.length?(ye(t),e):P},e.shapes=function(t){return arguments.length?(je(t),e):V},e.arrows=function(t){return arguments.length?(ue(t),e):k},e}var Le={paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,rx:0,ry:0,shape:`rect`},Re={arrowhead:`normal`,curve:o};function ze(e){e.nodes().forEach(function(t){var n=e.node(t);!C(n,`label`)&&!e.children(t).length&&(n.label=t),C(n,`paddingX`)&&w(n,{paddingLeft:n.paddingX,paddingRight:n.paddingX}),C(n,`paddingY`)&&w(n,{paddingTop:n.paddingY,paddingBottom:n.paddingY}),C(n,`padding`)&&w(n,{paddingLeft:n.padding,paddingRight:n.padding,paddingTop:n.padding,paddingBottom:n.padding}),w(n,Le),S([`paddingLeft`,`paddingRight`,`paddingTop`,`paddingBottom`],function(e){n[e]=Number(n[e])}),C(n,`width`)&&(n._prevWidth=n.width),C(n,`height`)&&(n._prevHeight=n.height)}),e.edges().forEach(function(t){var n=e.edge(t);C(n,`label`)||(n.label=``),w(n,Re)})}function Be(e){S(e.nodes(),function(t){var n=e.node(t);C(n,`_prevWidth`)?n.width=n._prevWidth:delete n.width,C(n,`_prevHeight`)?n.height=n._prevHeight:delete n.height,delete n._prevWidth,delete n._prevHeight})}function H(e,t){var n=e.select(`g.`+t);return n.empty()&&(n=e.append(`g`).attr(`class`,t)),n}var Ve=e(l()),He=e(u());function U(e,t,n){let r=t.width,i=t.height,a=(r+i)*.9,o=[{x:a/2,y:0},{x:a,y:-a/2},{x:a/2,y:-a},{x:0,y:-a/2}],s=Q(e,a,a,o);return n.intersect=function(e){return z(n,o,e)},s}function W(e,t,n){let r=4,i=t.height,a=i/r,o=t.width+2*a,s=[{x:a,y:0},{x:o-a,y:0},{x:o,y:-i/2},{x:o-a,y:-i},{x:a,y:-i},{x:0,y:-i/2}],c=Q(e,o,i,s);return n.intersect=function(e){return z(n,s,e)},c}function G(e,t,n){let r=t.width,i=t.height,a=[{x:-i/2,y:0},{x:r,y:0},{x:r,y:-i},{x:-i/2,y:-i},{x:0,y:-i/2}],o=Q(e,r,i,a);return n.intersect=function(e){return z(n,a,e)},o}function K(e,t,n){let r=t.width,i=t.height,a=[{x:-2*i/6,y:0},{x:r-i/6,y:0},{x:r+2*i/6,y:-i},{x:i/6,y:-i}],o=Q(e,r,i,a);return n.intersect=function(e){return z(n,a,e)},o}function q(e,t,n){let r=t.width,i=t.height,a=[{x:2*i/6,y:0},{x:r+i/6,y:0},{x:r-2*i/6,y:-i},{x:-i/6,y:-i}],o=Q(e,r,i,a);return n.intersect=function(e){return z(n,a,e)},o}function J(e,t,n){let r=t.width,i=t.height,a=[{x:-2*i/6,y:0},{x:r+2*i/6,y:0},{x:r-i/6,y:-i},{x:i/6,y:-i}],o=Q(e,r,i,a);return n.intersect=function(e){return z(n,a,e)},o}function Y(e,t,n){let r=t.width,i=t.height,a=[{x:i/6,y:0},{x:r-i/6,y:0},{x:r+2*i/6,y:-i},{x:-2*i/6,y:-i}],o=Q(e,r,i,a);return n.intersect=function(e){return z(n,a,e)},o}function X(e,t,n){let r=t.width,i=t.height,a=[{x:0,y:0},{x:r+i/2,y:0},{x:r,y:-i/2},{x:r+i/2,y:-i},{x:0,y:-i}],o=Q(e,r,i,a);return n.intersect=function(e){return z(n,a,e)},o}function Z(e,t,n){let r=t.height,i=t.width+r/4,a=e.insert(`rect`,`:first-child`).attr(`rx`,r/2).attr(`ry`,r/2).attr(`x`,-i/2).attr(`y`,-r/2).attr(`width`,i).attr(`height`,r);return n.intersect=function(e){return B(n,e)},a}function Ue(e,t,n){let r=t.width,i=t.height,a=[{x:0,y:0},{x:r,y:0},{x:r,y:-i},{x:0,y:-i},{x:0,y:0},{x:-8,y:0},{x:r+8,y:0},{x:r+8,y:-i},{x:-8,y:-i},{x:-8,y:0}],o=Q(e,r,i,a);return n.intersect=function(e){return z(n,a,e)},o}function We(e,t,n){let r=t.width,i=r/2,a=i/(2.5+r/50),o=t.height+a,s=`M 0,`+a+` a `+i+`,`+a+` 0,0,0 `+r+` 0 a `+i+`,`+a+` 0,0,0 `+-r+` 0 l 0,`+o+` a `+i+`,`+a+` 0,0,0 `+r+` 0 l 0,`+-o,c=e.attr(`label-offset-y`,a).insert(`path`,`:first-child`).attr(`d`,s).attr(`transform`,`translate(`+-r/2+`,`+-(o/2+a)+`)`);return n.intersect=function(e){let t=B(n,e),r=t.x-n.x;if(i!=0&&(Math.abs(r)<n.width/2||Math.abs(r)==n.width/2&&Math.abs(t.y-n.y)>n.height/2-a)){let o=a*a*(1-r*r/(i*i));o!=0&&(o=Math.sqrt(o)),o=a-o,e.y-n.y>0&&(o=-o),t.y+=o}return t},c}function Ge(e){e.shapes().question=U,e.shapes().hexagon=W,e.shapes().stadium=Z,e.shapes().subroutine=Ue,e.shapes().cylinder=We,e.shapes().rect_left_inv_arrow=G,e.shapes().lean_right=K,e.shapes().lean_left=q,e.shapes().trapezoid=J,e.shapes().inv_trapezoid=Y,e.shapes().rect_right_inv_arrow=X}function Ke(e){e({question:U}),e({hexagon:W}),e({stadium:Z}),e({subroutine:Ue}),e({cylinder:We}),e({rect_left_inv_arrow:G}),e({lean_right:K}),e({lean_left:q}),e({trapezoid:J}),e({inv_trapezoid:Y}),e({rect_right_inv_arrow:X})}function Q(e,t,n,r){return e.insert(`polygon`,`:first-child`).attr(`points`,r.map(function(e){return e.x+`,`+e.y}).join(` `)).attr(`transform`,`translate(`+-t/2+`,`+n/2+`)`)}const qe={addToRender:Ge,addToRenderV2:Ke},Je={},Ye=function(e){let t=Object.keys(e);for(let n of t)Je[n]=e[n]},Xe=async function(e,a,o,l,u,f){let m=l?l.select(`[id="${o}"]`):d(`[id="${o}"]`),h=u||document,g=Object.keys(e);for(let o of g){let l=e[o],u=`default`;l.classes.length>0&&(u=l.classes.join(` `));let d=i(l.styles),g=l.text===void 0?l.id:l.text,_;if(n(r().flowchart.htmlLabels)){let e={label:await c(g.replace(/fa[blrs]?:fa-[\w-]+/g,e=>`<i class='${e.replace(`:`,` `)}'></i>`),r())};_=p(m,e).node(),_.parentNode.removeChild(_)}else{let e=h.createElementNS(`http://www.w3.org/2000/svg`,`text`);e.setAttribute(`style`,d.labelStyle.replace(`color:`,`fill:`));let n=g.split(t.lineBreakRegex);for(let t of n){let n=h.createElementNS(`http://www.w3.org/2000/svg`,`tspan`);n.setAttributeNS(`http://www.w3.org/XML/1998/namespace`,`xml:space`,`preserve`),n.setAttribute(`dy`,`1em`),n.setAttribute(`x`,`1`),n.textContent=t,e.appendChild(n)}_=e}let v=0,y=``;switch(l.type){case`round`:v=5,y=`rect`;break;case`square`:y=`rect`;break;case`diamond`:y=`question`;break;case`hexagon`:y=`hexagon`;break;case`odd`:y=`rect_left_inv_arrow`;break;case`lean_right`:y=`lean_right`;break;case`lean_left`:y=`lean_left`;break;case`trapezoid`:y=`trapezoid`;break;case`inv_trapezoid`:y=`inv_trapezoid`;break;case`odd_right`:y=`rect_left_inv_arrow`;break;case`circle`:y=`circle`;break;case`ellipse`:y=`ellipse`;break;case`stadium`:y=`stadium`;break;case`subroutine`:y=`subroutine`;break;case`cylinder`:y=`cylinder`;break;case`group`:y=`rect`;break;default:y=`rect`}s.warn(`Adding node`,l.id,l.domId),a.setNode(f.db.lookUpDomId(l.id),{labelType:`svg`,labelStyle:d.labelStyle,shape:y,label:_,rx:v,ry:v,class:u,style:d.style,id:f.db.lookUpDomId(l.id)})}},$=async function(e,s,l){let u=0,d,f;if(e.defaultStyle!==void 0){let t=i(e.defaultStyle);d=t.style,f=t.labelStyle}for(let p of e){u++;let m=`L-`+p.start+`-`+p.end,h=`LS-`+p.start,g=`LE-`+p.end,_={};p.type===`arrow_open`?_.arrowhead=`none`:_.arrowhead=`normal`;let v=``,y=``;if(p.style!==void 0){let e=i(p.style);v=e.style,y=e.labelStyle}else switch(p.stroke){case`normal`:v=`fill:none`,d!==void 0&&(v=d),f!==void 0&&(y=f);break;case`dotted`:v=`fill:none;stroke-width:2px;stroke-dasharray:3;`;break;case`thick`:v=` stroke-width: 3.5px;fill:none`;break}_.style=v,_.labelStyle=y,p.interpolate===void 0?e.defaultInterpolate===void 0?_.curve=a(Je.curve,o):_.curve=a(e.defaultInterpolate,o):_.curve=a(p.interpolate,o),p.text===void 0?p.style!==void 0&&(_.arrowheadStyle=`fill: #333`):(_.arrowheadStyle=`fill: #333`,_.labelpos=`c`,n(r().flowchart.htmlLabels)?(_.labelType=`html`,_.label=`<span id="L-${m}" class="edgeLabel L-${h}' L-${g}" style="${_.labelStyle}">${await c(p.text.replace(/fa[blrs]?:fa-[\w-]+/g,e=>`<i class='${e.replace(`:`,` `)}'></i>`),r())}</span>`):(_.labelType=`text`,_.label=p.text.replace(t.lineBreakRegex,`
`),p.style===void 0&&(_.style=_.style||`stroke: #333; stroke-width: 1.5px;fill:none`),_.labelStyle=_.labelStyle.replace(`color:`,`fill:`))),_.id=m,_.class=h+` `+g,_.minlen=p.length||1,s.setEdge(l.db.lookUpDomId(p.start),l.db.lookUpDomId(p.end),_,u)}},Ze=function(e,t){return s.info(`Extracting classes`),t.db.getClasses()},Qe=async function(e,t,n,i){s.info(`Drawing flowchart`);let{securityLevel:a,flowchart:o}=r(),c;a===`sandbox`&&(c=d(`#i`+t));let l=d(a===`sandbox`?c.nodes()[0].contentDocument.body:`body`),u=a===`sandbox`?c.nodes()[0].contentDocument:document,p=i.db.getDirection();p===void 0&&(p=`TD`);let m=o.nodeSpacing||50,g=o.rankSpacing||50,_=new te({multigraph:!0,compound:!0}).setGraph({rankdir:p,nodesep:m,ranksep:g,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}}),v,y=i.db.getSubGraphs();for(let e=y.length-1;e>=0;e--)v=y[e],i.db.addVertex(v.id,v.title,`group`,void 0,v.classes);let b=i.db.getVertices();s.warn(`Get vertices`,b);let x=i.db.getEdges(),S=0;for(S=y.length-1;S>=0;S--){v=y[S],ee(`cluster`).append(`text`);for(let e=0;e<v.nodes.length;e++)s.warn(`Setting subgraph`,v.nodes[e],i.db.lookUpDomId(v.nodes[e]),i.db.lookUpDomId(v.id)),_.setParent(i.db.lookUpDomId(v.nodes[e]),i.db.lookUpDomId(v.id))}await Xe(b,_,t,l,u,i),await $(x,_,i);let C=new Ie;qe.addToRender(C),C.arrows().none=function(e,t,n,r){let i=e.append(`marker`).attr(`id`,t).attr(`viewBox`,`0 0 10 10`).attr(`refX`,9).attr(`refY`,5).attr(`markerUnits`,`strokeWidth`).attr(`markerWidth`,8).attr(`markerHeight`,6).attr(`orient`,`auto`),a=i.append(`path`).attr(`d`,`M 0 0 L 0 0 L 0 0 z`);h(a,n[r+`Style`])},C.arrows().normal=function(e,t){let n=e.append(`marker`).attr(`id`,t).attr(`viewBox`,`0 0 10 10`).attr(`refX`,9).attr(`refY`,5).attr(`markerUnits`,`strokeWidth`).attr(`markerWidth`,8).attr(`markerHeight`,6).attr(`orient`,`auto`);n.append(`path`).attr(`d`,`M 0 0 L 10 5 L 0 10 z`).attr(`class`,`arrowheadPath`).style(`stroke-width`,1).style(`stroke-dasharray`,`1,0`)};let w=l.select(`[id="${t}"]`),T=l.select(`#`+t+` g`);for(C(T,_),T.selectAll(`g.node`).attr(`title`,function(){return i.db.getTooltip(this.id)}),i.db.indexNodes(`subGraph`+S),S=0;S<y.length;S++)if(v=y[S],v.title!==`undefined`){let e=u.querySelectorAll(`#`+t+` [id="`+i.db.lookUpDomId(v.id)+`"] rect`),n=u.querySelectorAll(`#`+t+` [id="`+i.db.lookUpDomId(v.id)+`"]`),r=e[0].x.baseVal.value,a=e[0].y.baseVal.value,o=e[0].width.baseVal.value,s=d(n[0]),c=s.select(`.label`);c.attr(`transform`,`translate(${r+o/2}, ${a+14})`),c.attr(`id`,t+`Text`);for(let e=0;e<v.classes.length;e++)n[0].classList.add(v.classes[e])}if(!o.htmlLabels){let e=u.querySelectorAll(`[id="`+t+`"] .edgeLabel .label`);for(let t of e){let e=t.getBBox(),n=u.createElementNS(`http://www.w3.org/2000/svg`,`rect`);n.setAttribute(`rx`,0),n.setAttribute(`ry`,0),n.setAttribute(`width`,e.width),n.setAttribute(`height`,e.height),t.insertBefore(n,t.firstChild)}}f(_,w,o.diagramPadding,o.useMaxWidth);let E=Object.keys(b);E.forEach(function(e){let n=b[e];if(n.link){let r=l.select(`#`+t+` [id="`+i.db.lookUpDomId(e)+`"]`);if(r){let e=u.createElementNS(`http://www.w3.org/2000/svg`,`a`);e.setAttributeNS(`http://www.w3.org/2000/svg`,`class`,n.classes.join(` `)),e.setAttributeNS(`http://www.w3.org/2000/svg`,`href`,n.link),e.setAttributeNS(`http://www.w3.org/2000/svg`,`rel`,`noopener`),a===`sandbox`?e.setAttributeNS(`http://www.w3.org/2000/svg`,`target`,`_top`):n.linkTarget&&e.setAttributeNS(`http://www.w3.org/2000/svg`,`target`,n.linkTarget);let t=r.insert(function(){return e},`:first-child`),i=r.select(`.label-container`);i&&t.append(function(){return i.node()});let o=r.select(`.label`);o&&t.append(function(){return o.node()})}}})},$e={setConf:Ye,addVertices:Xe,addEdges:$,getClasses:Ze,draw:Qe},et={parser:ie,db:D,renderer:v,styles:y,init:e=>{e.flowchart||={},e.flowchart.arrowMarkerAbsolute=e.arrowMarkerAbsolute,$e.setConf(e.flowchart),D.clear(),D.setGen(`gen-1`)}};export{et as diagram};