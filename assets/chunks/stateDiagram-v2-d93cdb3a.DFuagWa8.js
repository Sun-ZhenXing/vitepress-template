import{__toESM as e,common$1 as t,configureSvgSize as n,getConfig as r,log$1 as i,require_dayjs_min as a,require_dist as o,select_default as s,utils as c}from"./mermaid-b5860b54.CzyV0eq4.js";import"./preload-helper.C0X9M0sG.js";import"./path.CnsJDNhh.js";import"./array.DpZ2OJ07.js";import"./line.DTlckFuN.js";import{Graph as l}from"./graphlib.B9UfIqo0.js";import"./clone.A1bABoxq.js";import"./createText-2e5e7dd3.DgWvnF3i.js";import"./edges-e0da2a9e.DFFloXIu.js";import"./dagre.v2GxACLv.js";import{render as u}from"./index-3862675e.Dv-q5Ebf.js";import{DEFAULT_NESTED_DOC_DIR as d,DEFAULT_STATE_TYPE as f,DIVIDER_TYPE as p,STMT_RELATION as m,STMT_STATE as h,db as g,parser$1 as _,styles as v}from"./styles-6aaf32cf.zv4wI12s.js";var y=e(a()),ee=e(o());const b=`rect`,x=`rectWithTitle`,S=`start`,C=`end`,w=`divider`,T=`roundedWithTitle`,E=`note`,D=`noteGroup`,O=`statediagram`,te=`state`,ne=`${O}-${te}`,k=`transition`,A=`note`,j=`note-edge`,M=`${k} ${j}`,N=`${O}-${A}`,P=`cluster`,F=`${O}-${P}`,I=`cluster-alt`,L=`${O}-${I}`,R=`parent`,z=`note`,re=`state`,B=`----`,V=`${B}${z}`,H=`${B}${R}`,U=`fill:none`,W=`fill: #333`,G=`c`,K=`text`,q=`normal`;let J={},Y=0;const ie=function(e){let t=Object.keys(e);for(let n of t)e[n]},ae=function(e,t){return t.db.extract(t.db.getRootDocV2()),t.db.getClasses()};function oe(e){return e==null?``:e.classes?e.classes.join(` `):``}function X(e=``,t=0,n=``,r=B){let i=n!==null&&n.length>0?`${r}${n}`:``;return`${re}-${e}${i}-${t}`}const Z=(e,n,a,o,s,c)=>{let l=a.id,u=oe(o[l]);if(l!==`root`){let n=b;a.start===!0&&(n=S),a.start===!1&&(n=C),a.type!==f&&(n=a.type),J[l]||(J[l]={id:l,shape:n,description:t.sanitizeText(l,r()),classes:`${u} ${ne}`});let o=J[l];a.description&&(Array.isArray(o.description)?(o.shape=x,o.description.push(a.description)):o.description.length>0?(o.shape=x,o.description===l?o.description=[a.description]:o.description=[o.description,a.description]):(o.shape=b,o.description=a.description),o.description=t.sanitizeTextOrArray(o.description,r())),o.description.length===1&&o.shape===x&&(o.shape=b),!o.type&&a.doc&&(i.info(`Setting cluster for `,l,Q(a)),o.type=`group`,o.dir=Q(a),o.shape=a.type===p?w:T,o.classes=o.classes+` `+F+` `+(c?L:``));let s={labelStyle:``,shape:o.shape,labelText:o.description,classes:o.classes,style:``,id:l,dir:o.dir,domId:X(l,Y),type:o.type,padding:15};if(s.centerLabel=!0,a.note){let t={labelStyle:``,shape:E,labelText:a.note.text,classes:N,style:``,id:l+V+`-`+Y,domId:X(l,Y,z),type:o.type,padding:15},n={labelStyle:``,shape:D,labelText:a.note.text,classes:o.classes,style:``,id:l+H,domId:X(l,Y,R),type:`group`,padding:0};Y++;let r=l+H;e.setNode(r,n),e.setNode(t.id,t),e.setNode(l,s),e.setParent(l,r),e.setParent(t.id,r);let i=l,c=t.id;a.note.position===`left of`&&(i=t.id,c=l),e.setEdge(i,c,{arrowhead:`none`,arrowType:``,style:U,labelStyle:``,classes:M,arrowheadStyle:W,labelpos:G,labelType:K,thickness:q})}else e.setNode(l,s)}n&&n.id!==`root`&&(i.trace(`Setting node `,l,` to be child of its parent `,n.id),e.setParent(l,n.id)),a.doc&&(i.trace(`Adding nodes children `),se(e,a,a.doc,o,s,!c))},se=(e,n,a,o,s,c)=>{i.trace(`items`,a),a.forEach(i=>{switch(i.stmt){case h:Z(e,n,i,o,s,c);break;case f:Z(e,n,i,o,s,c);break;case m:{Z(e,n,i.state1,o,s,c),Z(e,n,i.state2,o,s,c);let a={id:`edge`+Y,arrowhead:`normal`,arrowTypeEnd:`arrow_barb`,style:U,labelStyle:``,label:t.sanitizeText(i.description,r()),arrowheadStyle:W,labelpos:G,labelType:K,thickness:q,classes:k};e.setEdge(i.state1.id,i.state2.id,a,Y),Y++}break}})},Q=(e,t=d)=>{let n=t;if(e.doc)for(let t=0;t<e.doc.length;t++){let r=e.doc[t];r.stmt===`dir`&&(n=r.value)}return n},ce=async function(e,t,a,o){i.info(`Drawing state diagram (v2)`,t),J={},o.db.getDirection();let{securityLevel:d,state:f}=r(),p=f.nodeSpacing||50,m=f.rankSpacing||50;i.info(o.db.getRootDocV2()),o.db.extract(o.db.getRootDocV2()),i.info(o.db.getRootDocV2());let h=o.db.getStates(),g=new l({multigraph:!0,compound:!0}).setGraph({rankdir:Q(o.db.getRootDocV2()),nodesep:p,ranksep:m,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});Z(g,void 0,o.db.getRootDocV2(),h,o.db,!0);let _;d===`sandbox`&&(_=s(`#i`+t));let v=s(d===`sandbox`?_.nodes()[0].contentDocument.body:`body`),y=v.select(`[id="${t}"]`),ee=v.select(`#`+t+` g`);await u(ee,g,[`barb`],O,t);let x=8;c.insertTitle(y,`statediagramTitleText`,f.titleTopMargin,o.db.getDiagramTitle());let S=y.node().getBBox(),C=S.width+x*2,w=S.height+x*2;y.attr(`class`,O);let T=y.node().getBBox();n(y,w,C,f.useMaxWidth);let E=`${T.x-x} ${T.y-x} ${C} ${w}`;i.debug(`viewBox ${E}`),y.attr(`viewBox`,E);let D=document.querySelectorAll(`[id="`+t+`"] .edgeLabel .label`);for(let e of D){let t=e.getBBox(),n=document.createElementNS(`http://www.w3.org/2000/svg`,b);n.setAttribute(`rx`,0),n.setAttribute(`ry`,0),n.setAttribute(`width`,t.width),n.setAttribute(`height`,t.height),e.insertBefore(n,e.firstChild)}},le={setConf:ie,getClasses:ae,draw:ce},$={parser:_,db:g,renderer:le,styles:v,init:e=>{e.state||={},e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute,g.clear()}};export{$ as diagram};